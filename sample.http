###
# OpenSAML 4 Web Profile Demo - Sample HTTP Requests
#
# This file contains sample HTTP requests for testing the OpenSAML demo application.
# Before using these requests, make sure the application is running with:
# mvn tomcat:run
#
# Base URL: http://localhost:8080/opensaml4-webprofile-demo
###

@baseUrl = http://localhost:8080/opensaml4-webprofile-demo
@host = localhost:8080

###############################################################################
# Application Endpoints
###############################################################################

### 1. Access Application (Entry Point)
# This is the main entry point that triggers the SAML authentication flow
# The AccessFilter will intercept this request and initiate SAML authentication if not authenticated
GET {{baseUrl}}/app/appservlet
Accept: text/html

###############################################################################
# Service Provider (SP) Endpoints
###############################################################################

### 2. SP Consumer Service (Assertion Consumer Service)
# This endpoint receives SAML responses from the IdP
# Typically called by the IdP after authentication
# In a real scenario, this would receive SAML artifacts or assertions
GET {{baseUrl}}/sp/consumer?SAMLart=AAQAAMh48/1oXIM+sDo7Dh2qMp1HM4IF5DaRNmDj6RdUmllwn9jJHyEgIi8=
Accept: text/html

### 3. SP Consumer Service - POST binding
# Alternative POST binding for receiving SAML responses
POST {{baseUrl}}/sp/consumer
Content-Type: application/x-www-form-urlencoded

SAMLResponse=PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4...

###############################################################################
# Identity Provider (IdP) Endpoints
###############################################################################

### 4. IdP Single Sign-On Service
# This endpoint handles SAML authentication requests from SPs
# HTTP-Redirect binding - receives SAMLRequest as query parameter
GET {{baseUrl}}/idp/singleSignOnService?SAMLRequest=nZFBa4MwGIb%2FSsh9q02sWw%2BlFcaKjIKM0R%2B4JdYgJiHJKPv3S%2BnYYIfd9pV8z%2Fu%2BX6Ipck1Vo6Gw
Accept: text/html

### 5. IdP Single Sign-On Service - POST binding
# Alternative POST binding for receiving authentication requests
POST {{baseUrl}}/idp/singleSignOnService
Content-Type: application/x-www-form-urlencoded

SAMLRequest=PHNhbWxwOkF1dGhuUmVxdWVzdA...

### 6. IdP Artifact Resolution Service
# This endpoint resolves SAML artifacts to actual SAML assertions
# Uses SOAP binding
POST {{baseUrl}}/idp/artifactResolutionService
Content-Type: text/xml
SOAPAction: http://www.oasis-open.org/committees/security

<?xml version="1.0" encoding="UTF-8"?>
<soap11:Envelope xmlns:soap11="http://schemas.xmlsoap.org/soap/envelope/">
  <soap11:Body>
    <samlp:ArtifactResolve
      xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
      xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
      ID="_8e8dc5f69a98cc4c1ff3427e5ce34606fd672f91e6"
      Version="2.0"
      IssueInstant="2025-12-18T12:00:00Z">
      <saml:Issuer>http://localhost:8080/opensaml4-webprofile-demo/sp</saml:Issuer>
      <samlp:Artifact>AAQAAMh48/1oXIM+sDo7Dh2qMp1HM4IF5DaRNmDj6RdUmllwn9jJHyEgIi8=</samlp:Artifact>
    </samlp:ArtifactResolve>
  </soap11:Body>
</soap11:Envelope>

###############################################################################
# Health Check / Status Endpoints
###############################################################################

### 7. Check if server is running
GET http://{{host}}/
Accept: text/html

### 8. Check application deployment
GET {{baseUrl}}/
Accept: text/html

###############################################################################
# Common SAML Flow Simulation
###############################################################################

### Flow Step 1: User accesses protected resource
# @name step1
GET {{baseUrl}}/app/appservlet
Accept: text/html

###
# Expected: Redirect to IdP with SAMLRequest

### Flow Step 2: IdP processes authentication request
# (Extract SAMLRequest from redirect in step 1)
# @name step2
GET {{baseUrl}}/idp/singleSignOnService?SAMLRequest=<SAML_REQUEST_FROM_STEP_1>
Accept: text/html

###
# Expected: IdP returns SAML artifact

### Flow Step 3: SP resolves artifact at IdP
# @name step3
POST {{baseUrl}}/idp/artifactResolutionService
Content-Type: text/xml

<SOAP_ARTIFACT_RESOLVE_MESSAGE>

###
# Expected: IdP returns SAML assertion

### Flow Step 4: SP processes SAML response
# @name step4
GET {{baseUrl}}/sp/consumer?SAMLart=<ARTIFACT_FROM_STEP_2>
Accept: text/html

###
# Expected: User successfully authenticated and redirected to application

###############################################################################
# Notes
###############################################################################

# SAML Bindings Used:
# - HTTP-Redirect: Used for AuthnRequest (SP to IdP)
# - HTTP-Artifact: Used for Response (IdP to SP)
# - SOAP: Used for ArtifactResolve (SP to IdP backend channel)

# Security Considerations:
# - All SAML messages should be signed
# - Assertions should be encrypted
# - Timestamps should be validated
# - Replay attack prevention should be implemented

# For actual testing:
# 1. Start the application: mvn tomcat:run
# 2. Open a browser and navigate to: http://localhost:8080/opensaml4-webprofile-demo/app/appservlet
# 3. Watch the console for SAML message logs
# 4. Follow the authentication flow

# Metadata Endpoints (if implemented):
# GET {{baseUrl}}/sp/metadata
# GET {{baseUrl}}/idp/metadata
